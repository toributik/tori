<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Product Catalog</title>
  <link rel="icon" type="image/png" href="logo/logo.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="css/index-style.css" rel="stylesheet">
  <script src="js/script.js"></script>
</head>
<body>
    <div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    
    <!-- Fixed Navigation with Collapsible Filters -->
    <nav class="navbar navbar-expand-md navbar-css shadow-sm fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold text-success" href="#">Filters</a>
        
        <!-- Toggler Button for Mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#filterNav" aria-controls="filterNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Collapsible Content -->
        <div class="collapse navbar-collapse" id="filterNav">
          <div class="d-flex flex-column flex-md-row w-100 align-items-start align-items-md-center py-2">

            <!-- Left side: Search + Filters + Sort -->
            <div class="d-flex flex-column flex-md-row w-100 align-items-start align-items-md-center">
              <!-- Search Box -->
              <div class="mb-2 mb-md-0 me-md-3 w-100 w-md-auto search-container">
                <label for="searchInput" class="form-label mb-1 fw-bold">Search:</label>
                <input type="text" class="form-control " id="searchInput" placeholder="Search by title or ID">
              </div>

              <!-- Filter by Type -->
              <div class="mb-2 mb-md-0 me-md-3 w-100 w-md-auto">
                <label for="typeFilter" class="form-label mb-1 fw-bold">Filter by Type:</label>
                <select class="form-select form-select-sm" id="typeFilter">
                  <option value="all">All Available Products</option>
                  <option value="unavailable">Currently Not Available</option>
                  <!-- Product type options added dynamically -->
                </select>
              </div>

              <!-- Sort by -->
              <div class="mb-2 mb-md-0 me-md-3 w-100 w-md-auto">
                <label for="sortSelect" class="form-label mb-1 fw-bold">Sort by:</label>
                <select class="form-select form-select-sm" id="sortSelect">
                  <option value="random">Random</option>
                  <option value="name-asc">Name (A-Z)</option>
                  <option value="name-desc">Name (Z-A)</option>
                  <option value="price-asc">Price (Low to High)</option>
                  <option value="price-desc">Price (High to Low)</option>
                  <option value="discount-desc">Discount (High to Low)</option>
                </select>
              </div>
            </div>

            <!-- Right side: Buttons + Results Count -->
            <div class="d-flex ms-md-auto align-items-center mt-2 mt-md-0">
              <span class="text-muted small me-3" id="resultsCount">Loading products...</span>
              <a href="your-order.html" class="btn btn-sm btn-primary me-2">Orders</a>
              <button id="logoutBtn" class="btn btn-sm btn-danger">Logout</button>
            </div>

          </div>
        </div>
      </div>
    </nav>

    <!-- Horizontal Scroll Filter Buttons -->
    <div class="mb-1 d-flex justify-content-center">
      <div id="typeFilterButtons" 
           class="d-flex flex-nowrap py-2 scrollable-buttons" 
           style="gap: 8px; max-width: 100%;">
        <button class="btn btn-outline-primary btn-sm d-none" data-type="all">All Available</button>
        <button class="btn btn-outline-secondary btn-sm d-none" data-type="unavailable">Unavailable</button>
        <!-- Dynamic buttons will be added below -->
      </div>
    </div>

    <!-- New Products Horizontal Scroll Section -->
    <div class="container-fluid ForNewBadge  p-3 mb-3">
      <div id="newProductsContainer" class="new-products-section" style="display: none;">
        <h3 class=" bg-primary rounded">New Arrivals</h3>
        <div class="new-products-container">
          <div id="newProductsScroll" class="new-products-scroll">
            <!-- New product cards will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </div>

    <div class="container py-1">
      <!-- Loading State -->
      <div id="loadingContainer" class="loader-container">
        <div class="loader"></div>
      </div>
      
      <!-- Products Grid -->
      <div id="productContainer" class="row g-2" style="display: none;"></div>
      
      <!-- Empty State -->
      <div id="emptyContainer" class="text-center py-5" style="display: none;">
        <div class="py-5">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#6c757d" class="bi bi-box-seam mb-3" viewBox="0 0 16 16">
            <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
          </svg>
          <h4 class="text-muted">No products available</h4>
          <p class="text-muted">Check back later for new products.</p>
        </div>
      </div>
      
      <!-- Error State -->
      <div id="errorContainer" class="text-center py-5" style="display: none;">
        <div class="py-5">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#dc3545" class="bi bi-exclamation-triangle mb-3" viewBox="0 0 16 16">
            <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
            <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>
          </svg>
          <h4 class="text-danger">Error loading products</h4>
          <p id="errorMessage" class="text-muted"></p>
          <button id="retryButton" class="btn btn-primary mt-3">Try Again</button>
        </div>
      </div>
  </div>

    <!-- Mobile Number Modal -->
    <div class="modal fade" id="mobileModal" tabindex="-1" aria-labelledby="mobileModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="mobileModalLabel">Enter Your Mobile Number</h5>
          </div>
          <div class="modal-body">
            <input type="tel" id="mobileInputModal" class="form-control" placeholder="Enter your mobile number" maxlength="10">
          </div>
          <div class="modal-footer">
            <button type="button" id="saveMobileBtn" class="btn btn-primary">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer (Initially Hidden) - MOVED OUTSIDE CONTAINER -->
    <footer id="siteFooter" class="container-fluid text-center py-4 mt-5 bg-dark d-none">
  <div class="container-fluid">
    <small>
      <span id="lastUpdate" class="text-muted bg-light p-1 rounded mb-1">Last Updated: --</span><br>
      <span class="text-warning">© <span id="year"></span> | Designed by </span>
      <strong class="text-primary">Subitan Ganguly</strong> 
      
    </small>
  </div>
</footer>

<script>

  // Set current year
  document.getElementById("year").textContent = new Date().getFullYear();

  // Helper: format ISO date to "16 October 2025 8:04 PM"
  function formatDateTime(isoString) {
    if (!isoString) return "--";
    const date = new Date(isoString);

    // Convert to Indian time zone (IST)
    const options = {
      timeZone: "Asia/Kolkata",
      day: "numeric",
      month: "long",
      year: "numeric",
      hour: "numeric",
      minute: "2-digit",
      hour12: true,
    };
    return new Intl.DateTimeFormat("en-GB", options).format(date);
  }

  // Fetch Settings data and update footer
  fetch(`${scriptURL}?action=getSettings`)
    .then(res => res.json())
    .then(data => {
      if (Array.isArray(data) && data.length > 0) {
        const lastUpdate = data[0].lastupdateDatetime || "--";
        document.getElementById("lastUpdate").textContent =
          "Last Updated: " + formatDateTime(lastUpdate);
      }
      document.getElementById("siteFooter").classList.remove("d-none");
    })
    .catch(err => {
      console.error("Error loading settings:", err);
      document.getElementById("lastUpdate").textContent = "Last Updated: --";
      document.getElementById("siteFooter").classList.remove("d-none");
    });
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // DOM Elements
      const productContainer = document.getElementById("productContainer");
      const loadingContainer = document.getElementById("loadingContainer");
      const emptyContainer = document.getElementById("emptyContainer");
      const errorContainer = document.getElementById("errorContainer");
      const errorMessage = document.getElementById("errorMessage");
      const retryButton = document.getElementById("retryButton");
      const typeFilter = document.getElementById("typeFilter");
      const sortSelect = document.getElementById("sortSelect");
      const resultsCount = document.getElementById("resultsCount");
      const searchInput = document.getElementById("searchInput");
      const newProductsContainer = document.getElementById("newProductsContainer");
      const newProductsScroll = document.getElementById("newProductsScroll");
      const typeFilterButtons = document.getElementById("typeFilterButtons");

      // Global variables
      let allProducts = [];
      let filteredProducts = [];
      let currentFilter = "all";
      let currentSort = "random"; // Changed default to random
      let currentSearch = "";
      let isInitialLoad = true;
      let isFilterApplied = false;

      // Calculate discounted price
      function calculateDiscountedPrice(price, discount) {
        return price - (price * discount / 100);
      }

      // Format price with commas
      function formatPrice(price) {
        return '₹' + parseFloat(price).toLocaleString('en-IN');
      }

      // Create price display HTML
// Create price display HTML
function createPriceDisplay(product) {
  const price = parseFloat(product['Product Price']) || 0;
  const discount = parseFloat(product['Product Discount']) || 0;
  
  if (discount > 0) {
    const discountedPrice = calculateDiscountedPrice(price, discount);
    return `
      <div class="d-flex align-items-center gap-2">
        <span class="original-price text-muted text-decoration-line-through">${formatPrice(price)}</span>
        <span class="discounted-price fw-bold ">${formatPrice(discountedPrice)}</span>
      </div>
    `;
  } else {
    return `
      <div class="discounted-price fw-bold">${formatPrice(price)}</div>
    `;
  }
}

      // Create filter options based on product types
      function createFilterOptions(products) {
        // Get all unique product types from available products only
        const availableProducts = products.filter(p => 
          (p['Product Display'] || "").toLowerCase() === "yes"
        );
        const productTypes = [...new Set(availableProducts.map(p => p['Product Type'] || 'Uncategorized'))];
        
        // Add options for each product type
        productTypes.forEach(type => {
          const option = document.createElement('option');
          option.value = type;
          option.textContent = type;
          typeFilter.appendChild(option);
        });
      }

      function createDynamicFilterButtons(products) {
    if (!typeFilterButtons) return;

    // Clear existing buttons except the first two (All & Unavailable)
    typeFilterButtons.innerHTML = `
        <button class="btn btn-outline-primary btn-sm d-none" data-type="all">All Available</button>
        <button class="btn btn-outline-secondary btn-sm d-none" data-type="unavailable">Unavailable</button>
    `;

    // Get all unique types from available products
    const availableProducts = products.filter(p =>
        (p['Product Display'] || "").toLowerCase() === "yes"
    );
    const productTypes = [...new Set(availableProducts.map(p => p['Product Type'] || 'Uncategorized'))];

    productTypes.forEach(type => {
        const firstProduct = availableProducts.find(p => (p['Product Type'] || 'Uncategorized') === type);
        const imageSrc = firstProduct?.['Product Image'] || 'logo/default.jpg';

        const btn = document.createElement('button');
        btn.className = "type-btn";
        btn.dataset.type = type;

        btn.innerHTML = `
            <div class="type-btn-content">
                <div class="type-btn-front">
                    <div class="type-btn-circle rounded-circle d-flex align-items-center justify-content-center mb-1">
                        <img src="${imageSrc}" alt="${type}">
                    </div>
                    <small class="type-btn-text">${type}</small>
                </div>
                <div class="type-btn-back">
                    <small class="type-btn-text">${type}</small>
                    <div class="type-btn-circle rounded-circle d-flex align-items-center justify-content-center mt-1">
                        <img src="${imageSrc}" alt="${type}">
                    </div>
                </div>
            </div>
        `;

        btn.addEventListener("click", () => {
            window.location.href = `filter.html?type=${encodeURIComponent(type)}`;
        });

        typeFilterButtons.appendChild(btn);
    });
}

      // Create horizontal scroll for new products
      function createNewProductsScroll(products) {
        // Hide new arrivals if filters are applied
        if (isFilterApplied) {
          newProductsContainer.style.display = 'none';
          return;
        }

        // Clear previous content
        newProductsScroll.innerHTML = '';
        
        // Filter new products (within last 10 days)
        const newProducts = products.filter(p => 
          isNewProduct(p["Product Uploading Date"], 10) && 
          (p['Product Display'] || "").toLowerCase() === "yes"
        );

        if (newProducts.length === 0) {
          newProductsContainer.style.display = 'none';
          return;
        }

        // Show the new products section
        newProductsContainer.style.display = 'block';

        // Create cards for each new product
        newProducts.forEach(p => {
          const discountBadge = p["Product Discount"] && p["Product Discount"] > 0
            ? `<div class="discount-badge">-${p["Product Discount"]}% OFF</div>`
            : "";

          const productIdBadge = p["Product ID"]
            ? `<div class="product-id-badge">ID: ${p["Product ID"]}</div>`
            : "";

          const priceDisplay = createPriceDisplay(p);

          const card = `
            <div class="new-product-card">
              <a href="product-details.html?productId=${p['Product ID']}" class="card-link">
                <div class="card h-100 shadow-sm position-relative ">
                  <div class="new-badge">NEW</div>
                  <img class="logo-card-img" src="logo/logo.png">
                  ${discountBadge}
                  ${productIdBadge}
                  <img src="${p['Product Image']}" class="card-img-top" alt="${p['Product Name']}" 
                       onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg='">
                  <div class="card-body d-flex flex-column">
                    <span><span class="Product-Name"><strong>${p['Product Name']}</strong></span>
                    ${priceDisplay}</span>
                    <div class="mt-auto">
                      <a href="order.html?productId=${p['Product ID']}" class="btn btn-order w-100">Order Now</a>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          `;
          newProductsScroll.insertAdjacentHTML("beforeend", card);
        });
      }

      // Safe string conversion for search
      function safeToString(value) {
        if (value === null || value === undefined) return '';
        return String(value).toLowerCase();
      }

      // Get limited products per category (10 products max per category)
      function getLimitedProductsByCategory(products, limit = 10) {
        const categories = {};
        const limitedProducts = [];
        
        // Group products by category
        products.forEach(product => {
          const category = product['Product Type'] || 'Uncategorized';
          if (!categories[category]) {
            categories[category] = [];
          }
          categories[category].push(product);
        });
        
        // Take up to limit products from each category
        Object.values(categories).forEach(categoryProducts => {
          limitedProducts.push(...categoryProducts.slice(0, limit));
        });
        
        return limitedProducts;
      }

      // Apply filters, search and sorting
      function applyFiltersAndSort() {
        // Check if any filter is applied
        const hasActiveFilter = currentFilter !== 'all' || currentSearch.trim() !== '' || currentSort !== 'random';
        
        // Update filter state
        if (hasActiveFilter) {
          isFilterApplied = true;
          newProductsContainer.style.display = 'none';
        } else {
          isFilterApplied = false;
        }

        // Filter products by type and availability
        if (currentFilter === 'all') {
          filteredProducts = allProducts.filter(p => 
            (p['Product Display'] || "").toLowerCase() === "yes"
          );
        } else if (currentFilter === 'unavailable') {
          filteredProducts = allProducts.filter(p => 
            (p['Product Display'] || "").toLowerCase() === "no"
          );
        } else {
          filteredProducts = allProducts.filter(p => 
            p['Product Type'] === currentFilter && 
            (p['Product Display'] || "").toLowerCase() === "yes"
          );
        }
        
        // Apply search filter
        if (currentSearch.trim() !== '') {
          const searchTerm = currentSearch.toLowerCase().trim();
          filteredProducts = filteredProducts.filter(p => {
            const productName = safeToString(p['Product Name']);
            const productId = safeToString(p['Product ID']);
            
            return productName.includes(searchTerm) || productId.includes(searchTerm);
          });
        }
        
        // For initial load with no filters, show limited products
        if (isInitialLoad && !hasActiveFilter) {
          filteredProducts = getLimitedProductsByCategory(filteredProducts, 10);
        }
        
        // Sort products
        sortProducts();
        
        // Update results count
        updateResultsCount();
        
        // Render products
        renderProducts();

        // Reset initial load flag after first render
        if (isInitialLoad) {
          isInitialLoad = false;
        }
      }

      // Sort products based on current sort option
      function sortProducts() {
        switch(currentSort) {
          case 'random':
            // Shuffle array randomly
            for (let i = filteredProducts.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [filteredProducts[i], filteredProducts[j]] = [filteredProducts[j], filteredProducts[i]];
            }
            break;
          case 'name-asc':
            filteredProducts.sort((a, b) => safeToString(a['Product Name']).localeCompare(safeToString(b['Product Name'])));
            break;
          case 'name-desc':
            filteredProducts.sort((a, b) => safeToString(b['Product Name']).localeCompare(safeToString(a['Product Name'])));
            break;
          case 'price-asc':
            filteredProducts.sort((a, b) => (parseFloat(a['Product Price']) || 0) - (parseFloat(b['Product Price']) || 0));
            break;
          case 'price-desc':
            filteredProducts.sort((a, b) => (parseFloat(b['Product Price']) || 0) - (parseFloat(a['Product Price']) || 0));
            break;
          case 'discount-desc':
            filteredProducts.sort((a, b) => (parseFloat(b['Product Discount']) || 0) - (parseFloat(a['Product Discount']) || 0));
            break;
        }
      }

      // Update results count
      function updateResultsCount() {
        const totalCount = allProducts.length;
        const filteredCount = filteredProducts.length;
        
        let countText = `Showing ${filteredCount} of ${totalCount}`;
        
        if (currentFilter !== 'all') {
          countText += ` (filtered by: ${currentFilter})`;
        }
        
        if (currentSearch.trim() !== '') {
          countText += ` (search: "${currentSearch}")`;
        }

        if (isInitialLoad && !isFilterApplied) {
         // countText += ' - Showing 10 products per category';
        }
        
        resultsCount.textContent = countText;
      }

      // Render products to the grid without type headings
      // Render products to the grid without type headings
function renderProducts() {
  productContainer.innerHTML = "";

  if (filteredProducts.length === 0) {
    productContainer.style.display = 'none';
    emptyContainer.style.display = 'block';
    return;
  }

  productContainer.style.display = 'block';
  emptyContainer.style.display = 'none';

  // Create a single row for all products (no type headings)
  const row = document.createElement("div");
  row.className = "row g-2";

  filteredProducts.forEach(p => {
    const isAvailable = (p["Product Display"] || "").toLowerCase() === "yes";

    const discountBadge = p["Product Discount"] && p["Product Discount"] > 0 && isAvailable
      ? `<div class="discount-badge">-${p["Product Discount"]}% OFF</div>`
      : "";

    const productIdBadge = p["Product ID"]
      ? `<div class="product-id-badge">ID: ${p["Product ID"]}</div>`
      : "";

    const priceDisplay = isAvailable ? createPriceDisplay(p) : "";

    const productName = isAvailable
      ? p['Product Name']
      : `${p['Product Name']} <span class="text-danger small">(Currently Not Available)</span>`;

    const orderButton = isAvailable
      ? `<a href="order.html?productId=${p['Product ID']}" class="btn btn-order w-100">Order Now</a>`
      : `<button class="btn btn-secondary w-100" disabled>Currently Unavailable</button>`;

    const cardOverlay = !isAvailable ? 'bg-light opacity-75' : '';

    const newBadge = isNewProduct(p["Product Uploading Date"], 10) && isAvailable
      ? `<div class="new-badge">NEW</div>` 
      : "";

    const card = `
      <div class="col-xxl-2 col-lg-2 col-md-3 col-sm-4 col-6">
        <a href="${isAvailable ? `product-details.html?productId=${p['Product ID']}` : '#'}" 
           class="card-link ${!isAvailable ? 'pe-none' : ''}">
          <div class="card h-100 shadow-sm position-relative ${cardOverlay}">
            <img class="logo-card-img" src="logo/logo.png">
            ${newBadge}
            ${discountBadge}
            ${productIdBadge}
            
            <!-- Floating Share Button -->
            <button class="btn btn-share-floating" 
                    onclick="event.preventDefault(); event.stopPropagation(); shareProduct('${p['Product ID']}', '${p['Product Name']}', '${p['Product Image']}')">
              <i class="bi bi-share-fill"></i>
            </button>
         
            <!-- Image without loader -->
            <img src="${p['Product Image']}" class="card-img-top" alt="${p['Product Name']}" 
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg='">
            
            <div class="card-body d-flex flex-column">
              <div class="product-name mb-2">
                <strong>${productName}</strong>
              </div>
              <div class="price-container mb-2">
                ${priceDisplay}
              </div>
              <div class="mt-auto">
                ${orderButton}
              </div>
            </div>
          </div>
        </a>
      </div>
    `;
    row.insertAdjacentHTML("beforeend", card);
  });

  productContainer.appendChild(row);
}
      // Load products from API
      async function loadProducts() {
        try {
          // Show loading state
          loadingContainer.style.display = 'flex';
          productContainer.style.display = 'none';
          emptyContainer.style.display = 'none';
          errorContainer.style.display = 'none';
          newProductsContainer.style.display = 'none';

          const res = await fetch(`${scriptURL}?action=getProducts`);
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          
          const products = await res.json();
          
          // Store all products
          allProducts = products.filter(p => 
            p["Product Display"] !== undefined && p["Product Display"] !== null
          );

          // Hide loading, show appropriate state
          loadingContainer.style.display = 'none';
          
          if (allProducts.length === 0) {
            emptyContainer.style.display = 'block';
            return;
          }

          // Create filter options (only from available products)
          createFilterOptions(allProducts);
          createDynamicFilterButtons(allProducts);
          
          // Create new products horizontal scroll
          createNewProductsScroll(allProducts);
          
          // Apply initial filters and sorting
          applyFiltersAndSort();

          // Show footer after products are loaded
          document.getElementById("siteFooter").classList.remove("d-none");
          
        } catch (err) {
          // Show error state
          loadingContainer.style.display = 'none';
          productContainer.style.display = 'none';
          emptyContainer.style.display = 'none';
          errorContainer.style.display = 'block';
          newProductsContainer.style.display = 'none';
          errorMessage.textContent = err.message;
          console.error('Error loading products:', err);
        }
      }

      // Event listeners
      retryButton.addEventListener('click', loadProducts);
      
      // Filter change event
      typeFilter.addEventListener('change', function() {
        currentFilter = this.value;
        isFilterApplied = true;
        applyFiltersAndSort();
      });
      
      // Sort change event
      sortSelect.addEventListener('change', function() {
        currentSort = this.value;
        isFilterApplied = true;
        applyFiltersAndSort();
      });
      
      // Search input event with debouncing
      let searchTimeout;
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          currentSearch = this.value;
          isFilterApplied = true;
          applyFiltersAndSort();
        }, 300);
      });
      
      // Initialize
      loadProducts();

      // Check if a product is uploaded within the last `days` days
      function isNewProduct(uploadDateStr, days = 10) {
        if (!uploadDateStr) return false;

        // Parse date like "13 October 2025"
        const uploadDate = new Date(uploadDateStr);
        if (isNaN(uploadDate)) return false;

        const now = new Date();
        const diffTime = now - uploadDate;
        const diffDays = diffTime / (1000 * 60 * 60 * 24);

        return diffDays <= days;
      }
    </script>
    
    <script>
      function adjustBodyPadding() {
        const navbar = document.querySelector('.navbar');
        const navbarHeight = navbar.offsetHeight;
        document.body.style.paddingTop = navbarHeight + 20 + 'px';
      }

      window.addEventListener('load', adjustBodyPadding);
      window.addEventListener('resize', adjustBodyPadding);
      
      document.addEventListener('shown.bs.collapse', adjustBodyPadding);
      document.addEventListener('hidden.bs.collapse', adjustBodyPadding);
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const mobileKey = 'userMobile';
        const storedMobile = localStorage.getItem(mobileKey);
        
        const mobileModal = new bootstrap.Modal(document.getElementById('mobileModal'));
        const mobileInputModal = document.getElementById('mobileInputModal');
        const saveMobileBtn = document.getElementById('saveMobileBtn');

        if (!storedMobile) {
          mobileModal.show();
        }

        saveMobileBtn.addEventListener('click', () => {
          const mobile = mobileInputModal.value.trim();
          if (!mobile || !/^\d{10}$/.test(mobile)) {
            alert('Please enter a valid 10-digit mobile number.');
            return;
          }
          localStorage.setItem(mobileKey, mobile);
          mobileModal.hide();
        });
      });
    </script>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const scrollContainer = document.getElementById('typeFilterButtons');
        if (!scrollContainer) return;

        scrollContainer.addEventListener('wheel', (e) => {
          e.preventDefault();
          scrollContainer.scrollLeft += e.deltaY;
        });
      });
    </script>

    <script>
      const logoutBtn = document.getElementById('logoutBtn');

      function updateLogoutButton() {
        const storedMobile = localStorage.getItem('userMobile');
        if (storedMobile) {
          logoutBtn.classList.remove('d-none');
        } else {
          logoutBtn.classList.add('d-none');
        }
      }

      updateLogoutButton();

      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('userMobile');
        updateLogoutButton();
        location.reload();
      });
    </script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const scrollContainer = document.querySelector('.new-products-container');
  
  if (scrollContainer) {
    let scrollSpeed = 1;
    let direction = 1;
    let isPaused = false;

    function autoScroll() {
      if (!isPaused) {
        scrollContainer.scrollLeft += scrollSpeed * direction;

        if (
          scrollContainer.scrollLeft + scrollContainer.clientWidth >= scrollContainer.scrollWidth ||
          scrollContainer.scrollLeft <= 0
        ) {
          direction *= -1;
        }
      }

      requestAnimationFrame(autoScroll);
    }

    scrollContainer.addEventListener('mouseenter', () => {
      isPaused = true;
    });

    scrollContainer.addEventListener('mouseleave', () => {
      isPaused = false;
    });

    autoScroll();
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const scrollContainer = document.getElementById('typeFilterButtons');
    if (!scrollContainer) return;

    // Horizontal scroll with mouse wheel
    scrollContainer.addEventListener('wheel', (e) => {
        e.preventDefault(); // prevent vertical scroll
        scrollContainer.scrollLeft += e.deltaY; // scroll horizontally
    });
});
</script>
<script>
// Share product function
function shareProduct(productId, productName, productImage) {
  const productUrl = `${window.location.origin}/product-details.html?productId=${productId}`;
  const shareText = `Check out this product: ${productName}`;
  
  if (navigator.share) {
    // Web Share API for mobile devices
    navigator.share({
      title: productName,
      text: shareText,
      url: productUrl,
    })
    .catch(error => console.log('Error sharing:', error));
  } else if (navigator.clipboard) {
    // Fallback: Copy to clipboard
    navigator.clipboard.writeText(`${shareText} - ${productUrl}`)
      .then(() => {
        // Show success message
        showToast('Product link copied to clipboard!');
      })
      .catch(err => {
        console.error('Failed to copy: ', err);
        // Fallback to alert
        alert(`Share this product:\n${productName}\n${productUrl}`);
      });
  } else {
    // Final fallback
    alert(`Share this product:\n${productName}\n${productUrl}`);
  }
}

// Toast notification function
function showToast(message) {
  // Remove existing toast if any
  const existingToast = document.getElementById('shareToast');
  if (existingToast) {
    existingToast.remove();
  }
  
  const toast = document.createElement('div');
  toast.id = 'shareToast';
  toast.className = 'position-fixed bottom-0 end-0 p-3';
  toast.style.zIndex = '9999';
  toast.innerHTML = `
    <div class="toast show" role="alert">
      <div class="toast-header">
        <strong class="me-auto">Success</strong>
        <button type="button" class="btn-close" onclick="this.closest('.toast').remove()"></button>
      </div>
      <div class="toast-body">
        ${message}
      </div>
    </div>
  `;
  document.body.appendChild(toast);
  
  // Auto remove after 3 seconds
  setTimeout(() => {
    if (toast.parentNode) {
      toast.remove();
    }
  }, 3000);
}
</script>




</body>
</html>